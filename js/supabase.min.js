import{createClient}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const supabaseUrl="https://mmfipdjcnexhbreupfvo.supabase.co/",supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tZmlwZGpjbmV4aGJyZXVwZnZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODg3ODcxMzQsImV4cCI6MjAwNDM2MzEzNH0.kIyhaRVvMQ6r_mHc0wF1jijWT2i958426EjK7pIP1Gg",supabase=createClient(supabaseUrl,supabaseKey),form=document.getElementById("messageForm"),nombreInput=document.getElementById("nombre"),mensajeInput=document.getElementById("mensaje"),contenedor=document.getElementById("contenedorMensajes");let lastFetchedTimestamp=null;async function fetchData(){try{const query=supabase.from("posts").select("*").order("created_at",{ascending:!0});lastFetchedTimestamp&&query.gt("created_at",lastFetchedTimestamp);const{data:data,error:error}=await query;error?console.error("Error fetching posts:",error):data.forEach(item=>{const createdAt=new Date(item.created_at),day=createdAt.toLocaleString("es",{day:"numeric"}),month=createdAt.toLocaleString("es",{month:"long"}),year=createdAt.toLocaleString("es",{year:"numeric"}),time=createdAt.toLocaleString("es",{hour:"numeric",minute:"numeric",hour12:!0}),formattedDate=`el ${day} de ${month} de ${year}, a las ${time}`,messageElement=document.createElement("div");messageElement.classList.add("msg");const nameElement=document.createElement("span");nameElement.classList.add("name"),nameElement.textContent=item.nombre+", ";const dateElement=document.createElement("span");dateElement.classList.add("date"),dateElement.textContent=formattedDate;const contentElement=document.createElement("div");contentElement.classList.add("content"),contentElement.textContent=item.mensaje,messageElement.appendChild(nameElement),messageElement.appendChild(dateElement),messageElement.appendChild(contentElement),contenedor.appendChild(messageElement),(!lastFetchedTimestamp||item.created_at>lastFetchedTimestamp)&&(lastFetchedTimestamp=item.created_at)})}catch(error){console.error("Error:",error)}}form.addEventListener("submit",async e=>{e.preventDefault();const nombre=nombreInput.value,mensaje=mensajeInput.value,{data:data,error:error}=await supabase.from("posts").insert([{nombre:nombre,mensaje:mensaje}]);error||(nombreInput.value="",mensajeInput.value="",await fetchData(),window.scrollTo(0,document.body.scrollHeight))}),fetchData();